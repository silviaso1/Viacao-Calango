<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Ônibus</title>
    <link rel="stylesheet" href="./css/fazerCadastro.css">

    <style>
        
    /* Adicionando Flexbox para os itens cadastrados */
    .lista-cadastrados ul {
        list-style: none;
        padding: 0;
    }

  

    .lista-cadastrados li div {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    

    /* Estilizando os botões */
    .lista-cadastrados button {
        margin-left: 10px;
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 14px;
    }

    .editar {
        background-color: #4CAF50;
        color: white;
    }

    .excluir {
        background-color: #f44336;
        color: white;
    }

    .editar:hover {
        background-color: #45a049;
    }

    .excluir:hover {
        background-color: #e53935;
    }


    </style>
</head>
<body>
    <div class="container">
        <div class="cadastro">
            <h2 id="titulo-cadastro">Cadastro</h2>
            <form class="form-cadastro" id="formulario">
                <label for="modelo">Modelo:</label>
                <input type="text" id="modelo" name="modelo" required>
                <label for="placa">Placa:</label>
                <input type="text" id="placa" name="placa" required>
                <label for="ano">Ano:</label>
                <input type="text" id="ano" name="ano" required>
                <label for="capacidade">Capacidade:</label>
                <input type="text" id="capacidade" name="capacidade" required>
                <button type="button" id="btnCadastrar">Cadastrar</button>
            </form>
        </div>
        
        <div class="lista-cadastrados">
            <h2>Itens Cadastrados</h2>
            <ul id="lista-usuarios">
                <!-- A lista de itens cadastrados será exibida aqui -->
            </ul>
        </div>
    </div>

    <script>
        let onibusEmEdicao = null;

        document.getElementById('btnCadastrar').addEventListener('click', () => {
            const modelo = document.getElementById('modelo').value;
            const placa = document.getElementById('placa').value;
            const ano = document.getElementById('ano').value;
            const capacidade = document.getElementById('capacidade').value;

            const dados = { modelo, placa, ano, capacidade };

            if (onibusEmEdicao) {
                // Atualizar ônibus
                fetch('cadastrar_onibus.php', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: onibusEmEdicao, modelo, placa, ano, capacidade })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    listarOnibus();
                    limparFormulario();
                })
                .catch(error => {
                    console.error("Erro ao atualizar o ônibus:", error);
                    alert("Erro ao atualizar o ônibus.");
                });
            } else {
                // Cadastrar novo ônibus
                fetch('cadastrar_onibus.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    listarOnibus();
                    limparFormulario();
                })
                .catch(error => {
                    console.error("Erro ao cadastrar o ônibus:", error);
                    alert("Erro ao cadastrar o ônibus.");
                });
            }
        });

        function listarOnibus() {
    fetch('cadastrar_onibus.php')
        .then(response => response.json())
        .then(data => {
            const listaUsuarios = document.getElementById('lista-usuarios');
            listaUsuarios.innerHTML = '';

            data.forEach(onibus => {
                const li = document.createElement('li');

                // Criando uma estrutura flex para os dados
                const dadosContainer = document.createElement('div');
                dadosContainer.innerHTML = `
                    <div><strong>Modelo:</strong> ${onibus.modelo}</div>
                    <div><strong>Placa:</strong> ${onibus.placa}</div>
                    <div><strong>Ano:</strong> ${onibus.ano}</div>
                    <div><strong>Capacidade:</strong> ${onibus.capacidade}</div>
                `;

                // Adicionando os botões de editar e excluir
                const editarBtn = document.createElement('button');
                editarBtn.textContent = 'Editar';
                editarBtn.classList.add('editar');
                editarBtn.onclick = () => editarOnibus(onibus.id);

                const excluirBtn = document.createElement('button');
                excluirBtn.textContent = 'Deletar';
                excluirBtn.classList.add('excluir');
                excluirBtn.onclick = () => excluirOnibus(onibus.id);

                // Inserindo o container de dados e os botões no <li>
                li.appendChild(dadosContainer);
                li.appendChild(editarBtn);
                li.appendChild(excluirBtn);

                listaUsuarios.appendChild(li);
            });
        })
        .catch(error => {
            console.error("Erro ao listar os ônibus:", error);
        });
}



        // Função para excluir um ônibus
        function excluirOnibus(id) {
            if (confirm('Tem certeza que deseja excluir este ônibus?')) {
                fetch('cadastrar_onibus.php', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    listarOnibus();
                })
                .catch(error => {
                    console.error("Erro ao excluir o ônibus:", error);
                });
            }
        }

        // Função para editar um ônibus
        function editarOnibus(id) {
            fetch('cadastrar_onibus.php', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                const onibus = data.find(o => o.id === id);

                if (onibus) {
                    // Preencher os campos com os dados do ônibus
                    document.getElementById('modelo').value = onibus.modelo;
                    document.getElementById('placa').value = onibus.placa;
                    document.getElementById('ano').value = onibus.ano;
                    document.getElementById('capacidade').value = onibus.capacidade;

                    // Definir o ônibus em edição
                    onibusEmEdicao = onibus.id;
                    document.getElementById('btnCadastrar').innerText = "Atualizar"; // Mudar o texto do botão para 'Atualizar'
                }
            })
            .catch(error => {
                console.error("Erro ao editar o ônibus:", error);
            });
        }

        // Limpar formulário após operação
        function limparFormulario() {
            document.getElementById('modelo').value = '';
            document.getElementById('placa').value = '';
            document.getElementById('ano').value = '';
            document.getElementById('capacidade').value = '';
            onibusEmEdicao = null;
            document.getElementById('btnCadastrar').innerText = "Cadastrar"; // Mudar o texto do botão para 'Cadastrar'
        }

        // Carregar a lista de ônibus ao carregar a página
        window.onload = listarOnibus;
    </script>
</body>
</html>
